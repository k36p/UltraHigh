<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>تفاصيل المادة</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/frameWork.css">
    <link rel="stylesheet" href="/css/responsive.css" />
    <link rel="stylesheet" href="/css/normalize.css">
    <link rel="stylesheet" href="/css/hint.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://kit.fontawesome.com/503befbdb7.js" crossorigin="anonymous"></script>
    <script src="/js/script.js"></script>

    <!-- JavaScript -->
    <script src="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.min.css" />
    <!-- Default theme -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/default.min.css" />
    <!-- Semantic UI theme -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/semantic.min.css" />
    <!-- Bootstrap theme -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/bootstrap.min.css" />

    <!-- TAGS -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="<%= data.name %> - <%= data.specialization.name %> | جميع الكتب - جامعة الأقصى">
    <meta name="keywords"
        content="university, course,نماذج إختبارات,غزة,موقع مداد, <%= data.name %>, <%= data.specialization.name %>,مودل,جامعة الأقصى غزة">

    <meta property="og:title" content="<%= data.name %> | موقع مداد">
    <meta property="og:description" content="جميع الملفات والمحاضرات الخاصة في مادة <%= data.name %>">
    <meta property="og:image" content="<%= data.courseImageUrl %>">


</head>

<body>
    <div class="navbar">
        <% if(user) {%>
            <div class="userData">
                <img class="cover"
                    src="https://ik.imagekit.io/83055nufx/userIcon/<%=user.gender%>Student.png?updatedAt=1751925030845">
                <p class="username">
                    <%= user.username%>
                </p>
                <button onclick="window.location.href='/profile'" class="setting"><svg width="20" height="20"
                        viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M9.4415 0H10.5585C11.4193 0 12.1836 0.55086 12.4558 1.36754L12.88 2.63999C12.9573 2.87193 13.1169 3.06751 13.3286 3.18976L14.2334 3.7122C14.4451 3.83447 14.6943 3.87492 14.9339 3.8259L16.2479 3.55701C17.0913 3.38443 17.9505 3.77088 18.3809 4.51641L18.9394 5.48373C19.3698 6.22925 19.2749 7.16657 18.7037 7.81067L17.8139 8.8142C17.6516 8.9971 17.5621 9.2332 17.5621 9.4777V10.5224C17.5621 10.7669 17.6517 11.0029 17.8139 11.1859L18.7038 12.1894C19.275 12.8335 19.3699 13.7708 18.9395 14.5163L18.381 15.4837C17.9506 16.2292 17.0914 16.6156 16.248 16.4431L14.934 16.1742C14.6944 16.1251 14.4452 16.1656 14.2335 16.2878L13.3286 16.8102C13.1169 16.9325 12.9573 17.1281 12.88 17.36L12.4558 18.6325C12.1836 19.4491 11.4193 20 10.5585 20H9.4415C8.5806 20 7.81635 19.4491 7.54412 18.6325L7.11999 17.3601C7.04267 17.1281 6.88304 16.9325 6.67128 16.8102L5.76643 16.2879C5.55469 16.1656 5.30551 16.1252 5.06598 16.1742L3.75195 16.4431C2.90856 16.6157 2.04937 16.2293 1.61893 15.4837L1.06045 14.5164C0.630023 13.7709 0.724943 12.8336 1.2961 12.1895L2.18598 11.1859C2.3482 11.003 2.43777 10.767 2.43778 10.5225L2.43779 9.4776C2.43779 9.2331 2.34822 8.9971 2.18599 8.8141L1.29612 7.8106C0.724973 7.1665 0.630053 6.22919 1.06048 5.48366L1.61896 4.51634C2.04939 3.77081 2.90859 3.38436 3.75197 3.55695L5.06598 3.82584C5.30552 3.87486 5.55472 3.83442 5.76646 3.71217L6.6713 3.18976C6.88305 3.06751 7.04267 2.87192 7.11999 2.63996L7.54412 1.36754C7.81635 0.55086 8.5806 0 9.4415 0ZM10 13.5C11.933 13.5 13.5 11.933 13.5 10C13.5 8.067 11.933 6.5 10 6.5C8.067 6.5 6.5 8.067 6.5 10C6.5 11.933 8.067 13.5 10 13.5Z"
                            fill="whitesmoke" />
                    </svg>
                </button>
            </div>
            <% } else{%>
                <button onclick="window.location.href='/login'" class="notLoggedBtn">
                    تسجيل الدخول
                </button>
                <% } %>
                    <img src="media/midad2.png" class="logos">
                    <button id="action1" onclick="test()"><svg width="30" height="25" viewBox="0 0 30 25" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M0 2.08333C0 1.5308 0.225765 1.0009 0.627628 0.610195C1.02949 0.219494 1.57454 0 2.14286 0H27.8571C28.4255 0 28.9705 0.219494 29.3724 0.610195C29.7742 1.0009 30 1.5308 30 2.08333C30 2.63587 29.7742 3.16577 29.3724 3.55647C28.9705 3.94717 28.4255 4.16667 27.8571 4.16667H2.14286C1.57454 4.16667 1.02949 3.94717 0.627628 3.55647C0.225765 3.16577 0 2.63587 0 2.08333ZM0 12.5C0 11.9475 0.225765 11.4176 0.627628 11.0269C1.02949 10.6362 1.57454 10.4167 2.14286 10.4167H27.8571C28.4255 10.4167 28.9705 10.6362 29.3724 11.0269C29.7742 11.4176 30 11.9475 30 12.5C30 13.0525 29.7742 13.5824 29.3724 13.9731C28.9705 14.3638 28.4255 14.5833 27.8571 14.5833H2.14286C1.57454 14.5833 1.02949 14.3638 0.627628 13.9731C0.225765 13.5824 0 13.0525 0 12.5ZM0 22.9167C0 22.3641 0.225765 21.8342 0.627628 21.4435C1.02949 21.0528 1.57454 20.8333 2.14286 20.8333H27.8571C28.4255 20.8333 28.9705 21.0528 29.3724 21.4435C29.7742 21.8342 30 22.3641 30 22.9167C30 23.4692 29.7742 23.9991 29.3724 24.3898C28.9705 24.7805 28.4255 25 27.8571 25H2.14286C1.57454 25 1.02949 24.7805 0.627628 24.3898C0.225765 23.9991 0 23.4692 0 22.9167Z"
                                fill="#A5A5A8" />
                        </svg>
                    </button>
    </div>


    <div class="sidebar">
        <div class="contents">
            <ul class="list-ul">
                <li class="activeList1"><svg width="25" height="25" viewBox="0 0 25 25" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                        <path d="M9.35742 17.1113H15.1724" stroke="#a5a5a8" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M2.67871 14.6886C2.67871 9.05759 3.29271 9.45059 6.59771 6.38559C8.04371 5.22159 10.2937 2.97559 12.2367 2.97559C14.1787 2.97559 16.4737 5.21059 17.9327 6.38559C21.2377 9.45059 21.8507 9.05759 21.8507 14.6886C21.8507 22.9756 19.8917 22.9756 12.2647 22.9756C4.63771 22.9756 2.67871 22.9756 2.67871 14.6886Z"
                            stroke="#a5a5a8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <a href="/">الرئيسية</a>
                </li>
                <li><svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M15.8743 16.6719H8.6543" stroke="#a5a5a8" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <path d="M15.8743 12.9121H8.6543" stroke="#a5a5a8" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <path d="M11.4093 9.15234H8.6543" stroke="#a5a5a8" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M3.88867 12.9756C3.88867 19.9126 5.98667 22.2256 12.2797 22.2256C18.5737 22.2256 20.6707 19.9126 20.6707 12.9756C20.6707 6.03859 18.5737 3.72559 12.2797 3.72559C5.98667 3.72559 3.88867 6.03859 3.88867 12.9756Z"
                            stroke="#a5a5a8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>

                    <a href="/library">الكتب الجامعية</a>
                </li>
                <li> <svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M12.2783 3.72559C5.34132 3.72559 3.02832 6.03859 3.02832 12.9756C3.02832 19.9126 5.34132 22.2256 12.2783 22.2256C19.2153 22.2256 21.5283 19.9126 21.5283 12.9756"
                            stroke="#a5a5a8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M19.8064 5.27922V5.27922C18.8134 4.40022 17.2964 4.49222 16.4174 5.48522C16.4174 5.48522 12.0484 10.4202 10.5334 12.1332C9.01636 13.8452 10.1284 16.2102 10.1284 16.2102C10.1284 16.2102 12.6324 17.0032 14.1264 15.3152C15.6214 13.6272 20.0124 8.66822 20.0124 8.66822C20.8914 7.67522 20.7984 6.15822 19.8064 5.27922Z"
                            stroke="#a5a5a8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M15.2871 6.77637L18.8821 9.95937" stroke="#a5a5a8" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" />
                    </svg>

                    <a href="/edit">تعديل الملفات</a>
                </li>
                <li><svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M12.2742 3.49023C7.83993 3.49023 5.91326 7.50547 5.91326 10.1598C5.91326 12.1436 6.20088 11.5598 5.10279 13.9798C3.76184 17.4283 9.15422 18.8379 12.2742 18.8379C15.3933 18.8379 20.7856 17.4283 19.4456 13.9798C18.3475 11.5598 18.6352 12.1436 18.6352 10.1598C18.6352 7.50547 16.7075 3.49023 12.2742 3.49023Z"
                            stroke="#a5a5a8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M14.5839 21.4883C13.2896 22.934 11.2705 22.9511 9.96387 21.4883" stroke="#a5a5a8"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <a href="/notifications">إشعارات هامة</a>
                </li>
                <li><svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M12.2486 3.47559C5.86156 3.47559 4.78256 4.40759 4.78256 11.9046C4.78256 20.2976 4.62556 22.4756 6.22156 22.4756C7.81656 22.4756 10.4216 18.7916 12.2486 18.7916C14.0756 18.7916 16.6806 22.4756 18.2756 22.4756C19.8716 22.4756 19.7146 20.2976 19.7146 11.9046C19.7146 4.40759 18.6356 3.47559 12.2486 3.47559Z"
                            stroke="#a5a5a8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>

                    <a href="/bookMarks">قائمة المرجعيات</a>
                </li>
                <li><svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M11.7714 13.4136C11.7714 13.4136 -0.205275 10.936 3.95667 8.53341C7.46882 6.50611 19.5728 3.02056 21.2638 3.92116C22.1644 5.61216 18.6788 17.7161 16.6515 21.2283C14.249 25.3902 11.7714 13.4136 11.7714 13.4136Z"
                            stroke="#a5a5a8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M11.7715 13.4133L21.2639 3.9209" stroke="#a5a5a8" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <a href="/contact">تواصل</a>
                </li>
            </ul>
            <div class="footer-wright">
                <p class="right">© | Enigma - 2025</p>
            </div>
        </div>
    </div>

    <div class="block" onclick="hideblock()"></div>

    <div class="shareBox">

        <div class="contentShare">
            <div class="rtl">
                <button class="blockBox" onclick="hideShareBox()"><svg width="25" height="24" viewBox="0 0 25 24"
                        fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M9.27832 9L15.2783 15M15.2783 9L9.27832 15M5.27832 3H19.2783C20.3829 3 21.2783 3.89543 21.2783 5V19C21.2783 20.1046 20.3829 21 19.2783 21H5.27832C4.17375 21 3.27832 20.1046 3.27832 19V5C3.27832 3.89543 4.17375 3 5.27832 3Z"
                            stroke="#8A8AA3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </button>
                <h3>مشاركة</h3>
            </div>
            <ul>
                <li><a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:8080/book/<%=data.specialization._id%>"
                        target="_blank" rel="noopener noreferrer" aria-label="Share on Facebook">
                        <svg width="46" height="46" viewBox="0 0 46 46" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect y="0.000976562" width="45.56" height="45.56" rx="5" fill="#337FFF" />
                            <path
                                d="M28.3537 24.2628L29.0028 20.1384H25.0041V17.4575C25.0041 16.3298 25.5624 15.2278 27.3475 15.2278H29.1911V11.7156C28.1175 11.5444 27.0327 11.4518 25.9454 11.4385C22.6542 11.4385 20.5056 13.4169 20.5056 16.9935V20.1384H16.8574V24.2628H20.5056V34.2387H25.0041V24.2628H28.3537Z"
                                fill="white" />
                        </svg>

                    </a></li>
                <li><a href="https://wa.me/?text=[YOUR_ENCODED_TEXT]%20http://localhost:8080/book/<%=data.specialization._id%>"
                        target="_blank" rel="noopener noreferrer" aria-label="Share on WhatsApp">
                        <svg width="45" height="45" viewBox="0 0 45 45" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect width="45" height="45" rx="5" fill="#00D95F" />
                            <path
                                d="M11.25 32.9165L12.8643 26.914C11.5624 24.5758 11.1488 21.8472 11.6993 19.2291C12.2499 16.611 13.7277 14.2788 15.8616 12.6607C17.9955 11.0425 20.6423 10.2469 23.3163 10.4197C25.9904 10.5926 28.5123 11.7224 30.4193 13.6018C32.3264 15.4812 33.4906 17.9841 33.6983 20.6512C33.9061 23.3184 33.1434 25.9709 31.5503 28.122C29.9572 30.2731 27.6405 31.7785 25.0254 32.362C22.4102 32.9455 19.672 32.5679 17.3132 31.2985L11.25 32.9165ZM17.6056 29.0523L17.9806 29.2744C19.6891 30.2854 21.6846 30.7038 23.6562 30.4643C25.6277 30.2249 27.4646 29.341 28.8804 27.9505C30.2963 26.5601 31.2117 24.7411 31.4839 22.777C31.7561 20.8129 31.3699 18.8141 30.3855 17.092C29.401 15.3699 27.8736 14.0213 26.0413 13.2564C24.2089 12.4914 22.1746 12.3531 20.2553 12.8629C18.336 13.3728 16.6395 14.5021 15.4302 16.075C14.221 17.6479 13.5668 19.576 13.5698 21.5588C13.5682 23.2029 14.0236 24.8151 14.8854 26.2161L15.1206 26.6031L14.2181 29.9533L17.6056 29.0523Z"
                                fill="white" />
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M26.7064 23.1002C26.4866 22.9232 26.2292 22.7986 25.9539 22.736C25.6785 22.6733 25.3925 22.6742 25.1175 22.7386C24.7044 22.9099 24.4375 23.5571 24.1706 23.8807C24.1143 23.9583 24.0316 24.0127 23.938 24.0337C23.8443 24.0547 23.7463 24.0409 23.6621 23.9949C22.1497 23.4035 20.882 22.319 20.0648 20.9175C19.9951 20.8301 19.9622 20.719 19.9728 20.6078C19.9835 20.4965 20.037 20.3938 20.122 20.3211C20.4198 20.0268 20.6384 19.6624 20.7576 19.2615C20.7841 18.8192 20.6826 18.3787 20.4652 17.9925C20.2972 17.4509 19.9774 16.9688 19.5437 16.6029C19.32 16.5024 19.0719 16.4687 18.8294 16.5059C18.587 16.5431 18.3605 16.6495 18.1772 16.8123C17.8591 17.0863 17.6066 17.428 17.4383 17.8124C17.27 18.1967 17.1902 18.6138 17.2048 19.033C17.2058 19.2685 17.2357 19.5029 17.2938 19.731C17.4414 20.2792 17.6683 20.8029 17.9675 21.2855C18.1833 21.6553 18.4188 22.0132 18.673 22.3579C19.4989 23.4898 20.5371 24.4509 21.73 25.1878C22.3286 25.5622 22.9684 25.8667 23.6367 26.0951C24.3309 26.4093 25.0974 26.5299 25.8548 26.4441C26.2863 26.3789 26.6952 26.2088 27.0454 25.9488C27.3956 25.6888 27.6764 25.3468 27.8632 24.953C27.9729 24.7151 28.0062 24.4491 27.9585 24.1916C27.8441 23.6649 27.1386 23.354 26.7064 23.1002Z"
                                fill="white" />
                        </svg>


                    </a></li>
                <li><a href="https://t.me/share/url?url=http://localhost:8080/book/<%=data.specialization._id%>&text=[YOUR_ENCODED_TEXT]"
                        target="_blank" rel="noopener noreferrer" aria-label="Share on Telegram">
                        <svg width="45" height="45" viewBox="0 0 45 45" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect width="45" height="45" rx="5" fill="#34AADF" />
                            <path
                                d="M12.5191 21.7026C12.5191 21.7026 21.6742 17.8466 24.8493 16.4888C26.0665 15.9458 30.1942 14.2078 30.1942 14.2078C30.1942 14.2078 32.0994 13.4475 31.9406 15.294C31.8876 16.0544 31.4643 18.7155 31.041 21.594C30.4059 25.6673 29.718 30.1207 29.718 30.1207C29.718 30.1207 29.6121 31.3698 28.7125 31.5871C27.8129 31.8043 26.3311 30.8268 26.0665 30.6095C25.8548 30.4466 22.0975 28.0026 20.7216 26.8077C20.3512 26.4819 19.9278 25.8302 20.7745 25.0698C22.6796 23.2776 24.9552 21.0509 26.3311 19.6389C26.9661 18.9871 27.6011 17.4664 24.9552 19.3129C21.1979 21.9742 17.4935 24.4724 17.4935 24.4724C17.4935 24.4724 16.6468 25.0155 15.0592 24.5267C13.4716 24.038 11.6194 23.3862 11.6194 23.3862C11.6194 23.3862 10.3494 22.5716 12.5191 21.7026Z"
                                fill="white" />
                        </svg>


                    </a></li>
            </ul>
            <div class="pageLink">
                <p id="innerLink">http://localhost:8080/book/<%=data.specialization._id%><button
                            onclick="innerCopy(this,`http://localhost:8080/book/<%= data.specialization._id%>`)">نسخ
                            الرابط</button>
                </p>
            </div>
        </div>
    </div>

    <svg id="wave" style="transform:rotate(180deg); transition: 0.3s" viewBox="0 0 1440 390" version="1.1"
        xmlns="http://www.w3.org/2000/svg">
        <defs>
            <linearGradient id="sw-gradient-0" x1="0" x2="0" y1="1" y2="0">
                <stop stop-color="rgba(114, 51, 173, 1)" offset="0%"></stop>
                <stop stop-color="rgba(114, 51, 173, 1)" offset="100%"></stop>
            </linearGradient>
        </defs>
        <path style="transform:translate(0, 0px); opacity:1" fill="url(#sw-gradient-0)"
            d="M0,117L26.7,156C53.3,195,107,273,160,286C213.3,299,267,247,320,234C373.3,221,427,247,480,266.5C533.3,286,587,299,640,266.5C693.3,234,747,156,800,123.5C853.3,91,907,104,960,91C1013.3,78,1067,39,1120,26C1173.3,13,1227,26,1280,71.5C1333.3,117,1387,195,1440,240.5C1493.3,286,1547,299,1600,279.5C1653.3,260,1707,208,1760,195C1813.3,182,1867,208,1920,221C1973.3,234,2027,234,2080,195C2133.3,156,2187,78,2240,71.5C2293.3,65,2347,130,2400,143C2453.3,156,2507,117,2560,91C2613.3,65,2667,52,2720,78C2773.3,104,2827,169,2880,201.5C2933.3,234,2987,234,3040,208C3093.3,182,3147,130,3200,130C3253.3,130,3307,182,3360,182C3413.3,182,3467,130,3520,130C3573.3,130,3627,182,3680,169C3733.3,156,3787,78,3813,39L3840,0L3840,390L3813.3,390C3786.7,390,3733,390,3680,390C3626.7,390,3573,390,3520,390C3466.7,390,3413,390,3360,390C3306.7,390,3253,390,3200,390C3146.7,390,3093,390,3040,390C2986.7,390,2933,390,2880,390C2826.7,390,2773,390,2720,390C2666.7,390,2613,390,2560,390C2506.7,390,2453,390,2400,390C2346.7,390,2293,390,2240,390C2186.7,390,2133,390,2080,390C2026.7,390,1973,390,1920,390C1866.7,390,1813,390,1760,390C1706.7,390,1653,390,1600,390C1546.7,390,1493,390,1440,390C1386.7,390,1333,390,1280,390C1226.7,390,1173,390,1120,390C1066.7,390,1013,390,960,390C906.7,390,853,390,800,390C746.7,390,693,390,640,390C586.7,390,533,390,480,390C426.7,390,373,390,320,390C266.7,390,213,390,160,390C106.7,390,53,390,27,390L0,390Z">
        </path>
    </svg>
    <div class="path">
        <h5><a href="/">الرئيسية</a> </h5>
        <h5> / </h5>
        <h5><a href="/library">
                <%= data.specialization.name %>
            </a> </h5>
        <h5> / </h5>
        <h5>
            <%= data.name %>
        </h5>
    </div>

    <div class="topcontent">
        <div class="bookdata">
            <img loading="lazy" style="height: 100%;" src="<%= data.courseImageUrl %>" class="bookcover">
        </div>
        <div class="detailsBook">
            <p>
                <%= data.name %> <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M12 19.25V6.75M12 19.25L12.8284 18.4216C13.5786 17.6714 14.596 17.25 15.6569 17.25H18.25C18.8023 17.25 19.25 16.8023 19.25 16.25V5.75C19.25 5.19772 18.8023 4.75 18.25 4.75H14C12.8954 4.75 12 5.64543 12 6.75M12 19.25L11.1716 18.4216C10.4214 17.6714 9.40401 17.25 8.34315 17.25H5.75C5.19772 17.25 4.75 16.8023 4.75 16.25V5.75C4.75 5.19772 5.19772 4.75 5.75 4.75H10C11.1046 4.75 12 5.64543 12 6.75"
                            stroke="#8A8AA3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>

            </p>
            <p>
                <%= data.specialization.name %> <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M4.75 8L12 4.75L19.25 8M4.75 8L12 11.25L19.25 8M4.75 8V16L12 19.25L19.25 16V8M12 11.5V19"
                            stroke="#8A8AA3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>

            </p>
            <p>تاريخ النشر <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                    xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M12 8V12L14 14M19.25 12C19.25 16.0041 16.0041 19.25 12 19.25C7.99594 19.25 4.75 16.0041 4.75 12C4.75 7.99594 7.99594 4.75 12 4.75C16.0041 4.75 19.25 7.99594 19.25 12Z"
                        stroke="#8A8AA3" stroke-width="1.5" stroke-linecap="round" />
                </svg>

            </p>

            <p>
                <%= data.views %> <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M19.25 12C19.25 13 17.5 18.25 12 18.25C6.5 18.25 4.75 13 4.75 12C4.75 11 6.5 5.75 12 5.75C17.5 5.75 19.25 11 19.25 12Z"
                            stroke="#8A8AA3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                        <path
                            d="M14.25 12C14.25 13.2426 13.2426 14.25 12 14.25C10.7574 14.25 9.75 13.2426 9.75 12C9.75 10.7574 10.7574 9.75 12 9.75C13.2426 9.75 14.25 10.7574 14.25 12Z"
                            stroke="#8A8AA3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>

            </p>


            <p> <button onclick="bookMark(`<%= data._id %>`)" id="bookMark"
                    class="hint--top bookMark action-button bookmark-button" aria-label="إضافة الى المرجعيات">
                    <svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M12.2486 3.47559C5.86156 3.47559 4.78256 4.40759 4.78256 11.9046C4.78256 20.2976 4.62556 22.4756 6.22156 22.4756C7.81656 22.4756 10.4216 18.7916 12.2486 18.7916C14.0756 18.7916 16.6806 22.4756 18.2756 22.4756C19.8716 22.4756 19.7146 20.2976 19.7146 11.9046C19.7146 4.40759 18.6356 3.47559 12.2486 3.47559Z"
                            stroke="#9B51E0" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                    </svg> <a> إضافة الى المرجعيات</a>
                </button></p>

        </div>
    </div>

    <div class="contentsOfBooks" style="margin-top: 35px;">
        <div class="lists">
            <ul>
                <li class="sellected" data-content-type="files">ملفات المادة</li>
                <li data-content-type="groups">مجموعات المادة</li>
                <li data-content-type="youtube">شروحات يوتيوب</li>
            </ul>
        </div>

        <hr class="line">

        <div class="contentArea">
            <div class="dataList">
            </div>
        </div>

</body>
<script>

    document.addEventListener('DOMContentLoaded', function () {
        loadSavedBookmarks()
    });

    // Initialize alertify notification position
    alertify.set('notifier', 'position', 'bottom-right');

    // Constants
    const ERROR_MESSAGES = {
        INVALID_COURSE_ID: 'خطأ: معرّف الدورة التدريبية غير صالح في الرابط. يرجى التأكد من أن الرابط صحيح.',
        COURSE_NOT_FOUND: 'خطأ: لم يتم العثور على الدورة التدريبية (404).',
        NETWORK_ERROR: 'خطأ في الشبكة أو الخادم',
        UNKNOWN_ERROR: 'حدث خطأ غير متوقع',
        DOWNLOAD_ERROR: 'حدث خطأ أثناء تحميل الملف',
        SHARE_ERROR: 'حدث خطأ أثناء مشاركة الملف',
        COPY_SUCCESS: 'تم النسخ بنجاح',
        COPY_FAILED: 'فشل النسخ',
        INVALID_LINK: 'رابط غير صحيح'
    };

    // Centralized download logic using Fetch API and Blob
    async function downloadFileLogic(targetButton, fileUrl, fileName) {
        try {
            if (!fileUrl || !fileName) {
                throw new Error('Missing file URL or name');
            }

            // Show progress container (you'll need to add this HTML element)
            const progressContainer = document.getElementById('download-progress-container');
            if (progressContainer) {
                progressContainer.style.display = 'block';
                const progressBar = progressContainer.querySelector('.progress-bar');
                const progressText = progressContainer.querySelector('.progress-text');

                if (progressBar) progressBar.style.width = '0%';
                if (progressText) progressText.textContent = '0                <img loading="lazy" src="<%= data.courseImageUrl %>" class="bookcover">%';
            }

            const response = await fetch(fileUrl);
            if (!response.ok) {
                throw new Error(`${ERROR_MESSAGES.NETWORK_ERROR}: ${response.status} ${response.statusText}`);
            }

            // Get content length for progress calculation
            const contentLength = response.headers.get('Content-Length');
            let loaded = 0;
            // Create a reader to track progress
            const reader = response.body.getReader();
            const chunks = [];

            while (true) {
                const { done, value } = await reader.read();

                if (done) break;

                chunks.push(value);
                loaded += value.length;

                // Update progress if we know the total size
                if (contentLength) {
                    const percent = Math.round((loaded / contentLength) * 100);
                    const progressBar = targetButton;

                    progressBar.textContent = `تحميل الكتاب ${percent}%`;
                    // console.log(`Download progress: ${percent}%`);
                    // updateProgressCircle(percent);
                }
            }

            // Combine all chunks into a single Blob
            const blob = new Blob(chunks);
            const blobUrl = URL.createObjectURL(blob);

            const link = document.createElement('a');
            link.href = blobUrl;

            // Extract file extension from URL if available
            const lastDotIndex = fileUrl.lastIndexOf('.');
            const fileExtension = lastDotIndex !== -1 ? fileUrl.substring(lastDotIndex) : '';

            link.download = fileName + fileExtension;
            link.style.display = 'none';

            document.body.appendChild(link);
            link.click();

            // Cleanup
            setTimeout(() => {
                document.body.removeChild(link);
                URL.revokeObjectURL(blobUrl);
                if (progressContainer) {
                    progressContainer.style.display = 'none';
                }
            }, 100);

        } catch (error) {
            console.error(`${ERROR_MESSAGES.DOWNLOAD_ERROR}:`, error);
            alertify.error(`${ERROR_MESSAGES.DOWNLOAD_ERROR}: ${error.message || ERROR_MESSAGES.UNKNOWN_ERROR}`);
            throw error;
        }
    }
    // Helper function to show temporary message
    function showTempMessage(message, duration = 3000) {
        const tempMessage = document.createElement('div');
        tempMessage.textContent = message;
        tempMessage.style.cssText = `
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 1000;
            animation: fadeInOut ${duration}ms ease-in-out;
        `;

        document.body.appendChild(tempMessage);

        setTimeout(() => {
            tempMessage.style.animation = 'fadeOut 500ms ease-in-out';
            setTimeout(() => tempMessage.remove(), 500);
        }, duration - 500);
    }

    // Helper function to safely parse JSON
    async function safeJsonParse(response) {
        try {
            return await response.json();
        } catch (error) {
            console.error('Error parsing JSON:', error);
            throw new Error('Invalid JSON response from server');
        }
    }

    // Main function to initialize the application
    async function initializeApp() {
        try {
            const contentArea = document.querySelector('.contentArea');
            if (!contentArea) {
                throw new Error('Content area element not found');
            }

            // Extract course ID from URL
            const pathSegments = window.location.pathname.split('/');
            const courseId = pathSegments[pathSegments.length - 1];

            // Validate course ID
            if (!courseId || courseId === 'book' || courseId.length !== 24) {
                contentArea.innerHTML = `<p>${ERROR_MESSAGES.INVALID_COURSE_ID}</p>`;
                console.error("Invalid Course ID:", courseId);
                return;
            }

            contentArea.innerHTML = ''; // Clear loading state

            // Fetch course data
            let fullCourseData;
            try {
                const response = await fetch(`/data/${courseId}`);
                if (!response.ok) {
                    if (response.status === 404) {
                        throw new Error(ERROR_MESSAGES.COURSE_NOT_FOUND);
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                fullCourseData = await safeJsonParse(response);
                console.log('Full Course Data Loaded:', fullCourseData);
            } catch (error) {
                console.error('Error fetching course data:', error);
                contentArea.innerHTML = `
                    <p>خطأ في تحميل المحتوى: ${error.message || ERROR_MESSAGES.UNKNOWN_ERROR}</p>
                    <p>يرجى المحاولة مرة أخرى أو التحقق من الرابط.</p>
                `;
                return;
            }

            // Set up navigation
            const listItems = document.querySelectorAll('.lists ul li');
            if (!listItems.length) {
                console.warn('No navigation items found');
                return;
            }

            listItems.forEach(item => {
                item.addEventListener('click', () => {
                    // Update UI state
                    listItems.forEach(li => li.classList.remove('sellected'));
                    item.classList.add('sellected');

                    // Get content type and prepare data
                    const contentType = item.dataset.contentType;
                    const dataToRender = getContentData(fullCourseData, contentType);

                    // Render content
                    renderContent(dataToRender, contentType, contentArea);
                });
            });

            // Trigger default selection
            const defaultSelectedItem = document.querySelector('.lists ul li.sellected') || listItems[0];
            if (defaultSelectedItem) {
                defaultSelectedItem.click();
            }

            // Set up event delegation for dynamic elements
            setupEventDelegation();

        } catch (error) {
            console.error('Initialization error:', error);
            alertify.error(`خطأ في التطبيق: ${error.message || ERROR_MESSAGES.UNKNOWN_ERROR}`);
        }
    }

    // Helper function to get content data based on type
    function getContentData(fullCourseData, contentType) {
        switch (contentType) {
            case 'files':
                return {
                    name: fullCourseData.name,
                    syllabusPdfUrl: fullCourseData.syllabusPdfUrl,
                    additionalFiles: fullCourseData.additionalFiles || []
                };
            case 'youtube':
                return {
                    youtubeLinks: fullCourseData.youtubeLinks || []
                };
            case 'groups':
                return {
                    groupLinks: fullCourseData.groupLinks || []
                };
            default:
                console.warn(`Unknown content type: ${contentType}. Returning full data.`);
                return fullCourseData;
        }
    }

    // Main content rendering function
    function renderContent(data, contentType, contentArea) {
        try {
            contentArea.innerHTML = ''; // Clear previous content

            switch (contentType) {
                case 'files':
                    renderFilesContent(data, contentArea);
                    break;
                case 'youtube':
                    renderYoutubeContent(data, contentArea);
                    break;
                case 'groups':
                    renderGroupsContent(data, contentArea);
                    break;
                default:
                    console.error(`Unsupported content type: ${contentType}`);
                    contentArea.innerHTML = `<p>نوع المحتوى غير مدعوم</p>`;
            }
        } catch (error) {
            console.error(`Error rendering ${contentType} content:`, error);
            contentArea.innerHTML = `
                <p>حدث خطأ أثناء عرض المحتوى</p>
                <p>${error.message || ERROR_MESSAGES.UNKNOWN_ERROR}</p>
            `;
        }
    }

    // Render files content
    function renderFilesContent(data, contentArea) {
        let filesHtml = '';
        let hasFiles = false;

        // Main syllabus file
        if (data.syllabusPdfUrl) {
            hasFiles = true;
            const primaryFilename = data.name;
            filesHtml += `
                <div class="dataList">
                    <p>1</p>
                    <p class="booktitle">${primaryFilename} (الرئيسي)</p>
                    <p class="filetype">الكتاب الأساسي</p>
                    ${renderActionButtons(data.syllabusPdfUrl, primaryFilename)}
                </div>
            `;
        }

        // Additional files
        if (data.additionalFiles?.length) {
            data.additionalFiles.forEach((file, index) => {
                hasFiles = true;
                const suggestedFilename = file.fileName || file.title;
                filesHtml += `
                    <div class="dataList">
                        <p>${index + 1 + (data.syllabusPdfUrl ? 1 : 0)}</p>
                        <p class="booktitle">${suggestedFilename}</p>
                        <p class="filetype">${file.fileType || 'ملف'}</p>
                        ${renderActionButtons(file.fileUrl, suggestedFilename)}
                    </div>
                `;
            });
        }

        // No files case
        if (!hasFiles) {
            contentArea.innerHTML = renderNoDataTemplate('لايوجد ملفات متاحة لهذه المادة');
        } else {
            contentArea.innerHTML = filesHtml;
        }
    }

    // Render YouTube content
    function renderYoutubeContent(data, contentArea) {
        if (data.youtubeLinks?.length) {
            let youtubeHtml = '';
            data.youtubeLinks.forEach((link, index) => {
                youtubeHtml += `
                    <div class="dataList">
                        <p>${index + 1}</p>
                        <p class="booktitle">${link.title}</p>
                        <button link="${link.url}" class="innerWatch hint--top" aria-label="مشاهدة الفيديو داخل الموقع">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M15.25 19.25L12 17.25L8.75 19.25M6.75 16.25H17.25C18.3546 16.25 19.25 15.3546 19.25 14.25V6.75C19.25 5.64543 18.3546 4.75 17.25 4.75H6.75C5.64543 4.75 4.75 5.64543 4.75 6.75V14.25C4.75 15.3546 5.64543 16.25 6.75 16.25Z" stroke="#69FCA8" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <button href="${link.url}" class="outWatch hint--top" aria-label="مشاهدة في اليوتيوب">
                            <svg width="24" height="16" viewBox="0 0 24 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M1 2.93103C1 1.86455 2.35858 1 4.03448 1H19.9655C21.6414 1 23 1.86455 23 2.93103V13.069C23 14.1354 21.6414 15 19.9655 15H12H4.03448C2.35858 15 1 14.1354 1 13.069V2.93103Z" stroke="#F3164E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M16.4138 8.30831L10 5.17037V11.4462L16.4138 8.30831Z" stroke="#F3164E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <button onclick="copyLink(this)" link="${link.url}" class="copyLink hint--top" aria-label="نسخ الرابط">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M6.5 15.25C5.5335 15.25 4.75 14.4665 4.75 13.5V6.75C4.75 5.64543 5.64543 4.75 6.75 4.75H13.5C14.4665 4.75 15.25 5.5335 15.25 6.5M10.75 19.25H17.25C18.3546 19.25 19.25 18.3546 19.25 17.25V10.75C19.25 9.64543 18.3546 8.75 17.25 8.75H10.75C9.64543 8.75 8.75 9.64543 8.75 10.75V17.25C8.75 18.3546 9.64543 19.25 10.75 19.25Z" stroke="#3182ce" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                `;
            });
            contentArea.innerHTML = youtubeHtml;
        } else {
            contentArea.innerHTML = renderNoDataTemplate('لايوجد شرروحات متاحة لهذه المادة');
        }
    }

    // Render groups content
    function renderGroupsContent(data, contentArea) {
        if (data.groupLinks?.length) {
            let groupsHtml = '';
            data.groupLinks.forEach((link, index) => {
                groupsHtml += `
                    <div class="dataList">
                        <p>${index + 1}</p>
                        <p class="booktitle">${link.title}</p>
                        <p class="filetype">${link.platform || 'مجموعة'}</p>
                        <button href="${link.url}" class="group-link-direct hint--top" aria-label="فتح الرابط">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16.75 13.25L18 12C19.6568 10.3432 19.6568 7.65688 18 6.00003C16.3431 4.34317 13.6568 4.34317 12 6.00003L10.75 7.25003M7.25 10.75L5.99999 12C4.34314 13.6569 4.34314 16.3432 6 18C7.65685 19.6569 10.3431 19.6569 12 18L13.25 16.75M14.25 9.75003L9.75 14.25" stroke="#69FCA8" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <button onclick="copyLink(this)" link="${link.url}" class="copyLink hint--top" aria-label="نسخ الرابط">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M6.5 15.25C5.5335 15.25 4.75 14.4665 4.75 13.5V6.75C4.75 5.64543 5.64543 4.75 6.75 4.75H13.5C14.4665 4.75 15.25 5.5335 15.25 6.5M10.75 19.25H17.25C18.3546 19.25 19.25 18.3546 19.25 17.25V10.75C19.25 9.64543 18.3546 8.75 17.25 8.75H10.75C9.64543 8.75 8.75 9.64543 8.75 10.75V17.25C8.75 18.3546 9.64543 19.25 10.75 19.25Z" stroke="#3182ce" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                `;
            });
            contentArea.innerHTML = groupsHtml;
        } else {
            contentArea.innerHTML = renderNoDataTemplate('لايوجد أي روابط لمجموعات المادة بعد');
        }
    }

    // Helper function to render action buttons
    function renderActionButtons(fileUrl, fileName) {
        return `
            <div class="action-buttons-group">
                <button id="downBook" class="hint--top action-button download-file-button" aria-label="تحميل الكتاب"
                    data-file-url="${fileUrl}"
                    data-file-name="${fileName}">
                    <svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12.2783 17.0616V8.88965" stroke="#69FCA8" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M16.0303 13.2969C16.0303 13.2969 13.5023 17.0609 12.2783 17.0609C11.0543 17.0609 8.53027 13.2969 8.53027 13.2969" stroke="#69FCA8" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M3.02832 12.9756C3.02832 19.9126 5.34132 22.2256 12.2783 22.2256C19.2153 22.2256 21.5283 19.9126 21.5283 12.9756C21.5283 6.03859 19.2153 3.72559 12.2783 3.72559C5.34132 3.72559 3.02832 6.03859 3.02832 12.9756Z" stroke="#69FCA8" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                 <button onclick="showShareBox()" id="shareFile" class="hint--top action-button share-button" aria-label="مشاركة">
                    <svg width="23" height="23" viewBox="0 0 23 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.25 21.0833C18.8378 21.0833 20.125 19.7962 20.125 18.2083C20.125 16.6205 18.8378 15.3333 17.25 15.3333C15.6622 15.3333 14.375 16.6205 14.375 18.2083C14.375 19.7962 15.6622 21.0833 17.25 21.0833Z" stroke="#3182ce" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M5.75 14.375C7.33782 14.375 8.625 13.0878 8.625 11.5C8.625 9.91218 7.33782 8.625 5.75 8.625C4.16218 8.625 2.875 9.91218 2.875 11.5C2.875 13.0878 4.16218 14.375 5.75 14.375Z" stroke="#3182ce" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8.23209 12.9471L14.7775 16.7612" stroke="#3182ce" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M17.25 7.66666C18.8378 7.66666 20.125 6.37948 20.125 4.79166C20.125 3.20384 18.8378 1.91666 17.25 1.91666C15.6622 1.91666 14.375 3.20384 14.375 4.79166C14.375 6.37948 15.6622 7.66666 17.25 7.66666Z" stroke="#3182ce" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M14.7679 6.23877L8.23209 10.0529" stroke="#3182ce" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
        `;
    }

    // Helper function to render no data template
    function renderNoDataTemplate(message) {
        return `
            <div class="noData">
                <svg width="119" height="110" viewBox="0 0 119 110" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M103.25 26.99V31.3" stroke="#4A5059" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M101.1 29.15H105.4" stroke="#4A5059" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M15.09 10.36V14.67" stroke="#4A5059" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12.9301 12.51H17.2401" stroke="#4A5059" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M48.5499 2.28996C49.0912 2.28996 49.5299 1.85119 49.5299 1.30996C49.5299 0.768717 49.0912 0.329956 48.5499 0.329956C48.0087 0.329956 47.5699 0.768717 47.5699 1.30996C47.5699 1.85119 48.0087 2.28996 48.5499 2.28996Z" fill="#4A5059"/>
                    <path d="M79.97 41.25C71.59 41.25 63.08 40.92 55.11 38.7C47.29 36.5 40.15 32.32 33.71 27.5C29.51 24.32 25.71 21.8 20.26 22.18C14.9469 22.4538 9.8614 24.4235 5.75001 27.8C-1.17999 33.86 -0.129995 45.07 2.64001 52.95C6.8 64.82 19.5 73.07 30.22 78.44C42.65 84.65 56.3 88.26 70 90.33C82 92.16 97.41 93.48 107.81 85.64C117.37 78.44 119.99 62 117.65 50.9C117.081 47.6187 115.331 44.6591 112.73 42.58C106.02 37.67 96.02 40.95 88.48 41.11C85.68 41.17 82.83 41.24 79.97 41.25Z" fill="#272933"/>
                    <path d="M59.48 109.79C79.7544 109.79 96.19 108.765 96.19 107.5C96.19 106.235 79.7544 105.21 59.48 105.21C39.2056 105.21 22.77 106.235 22.77 107.5C22.77 108.765 39.2056 109.79 59.48 109.79Z" fill="#272933"/>
                    <path d="M75.0746 3.65264L26.1993 10.2608C24.634 10.4725 23.5367 11.913 23.7483 13.4783L33.2265 83.5804C33.4381 85.1457 34.8786 86.2431 36.4439 86.0314L85.3192 79.4232C86.8845 79.2116 87.9818 77.7711 87.7702 76.2058L78.292 6.10365C78.0804 4.53836 76.6399 3.44101 75.0746 3.65264Z" fill="#4A5059"/>
                    <path d="M91.32 13.95H42C40.4205 13.95 39.14 15.2304 39.14 16.81V87.55C39.14 89.1295 40.4205 90.41 42 90.41H91.32C92.8995 90.41 94.18 89.1295 94.18 87.55V16.81C94.18 15.2304 92.8995 13.95 91.32 13.95Z" fill="#2D333E" stroke="#4A5059" stroke-miterlimit="10"/>
                    <path d="M78.5099 68.86H54.7999C53.9108 68.86 53.1899 69.5808 53.1899 70.47V70.48C53.1899 71.3692 53.9108 72.09 54.7999 72.09H78.5099C79.3991 72.09 80.1199 71.3692 80.1199 70.48V70.47C80.1199 69.5808 79.3991 68.86 78.5099 68.86Z" fill="#4A5059"/>
                    <path d="M77.66 82.0601H54.91C54.6394 82.0601 54.42 82.2794 54.42 82.5501V82.7001C54.42 82.9707 54.6394 83.1901 54.91 83.1901H77.66C77.9307 83.1901 78.15 82.9707 78.15 82.7001V82.5501C78.15 82.2794 77.9307 82.0601 77.66 82.0601Z" fill="#4A5059"/>
                    <path d="M83.46 76.77H49.95C49.5911 76.77 49.3 77.061 49.3 77.42C49.3 77.779 49.5911 78.07 49.95 78.07H83.46C83.819 78.07 84.11 77.779 84.11 77.42C84.11 77.061 83.819 76.77 83.46 76.77Z" fill="#4A5059"/>
                    <path d="M89.59 16.27H43.73C42.5923 16.27 41.67 17.1923 41.67 18.33V58.1C41.67 59.2377 42.5923 60.16 43.73 60.16H89.59C90.7277 60.16 91.65 59.2377 91.65 58.1V18.33C91.65 17.1923 90.7277 16.27 89.59 16.27Z" fill="#2D333E" stroke="#4A5059" stroke-miterlimit="10"/>
                    <path d="M72.78 47.84C73.1093 47.8378 73.4299 47.7339 73.698 47.5427C73.9661 47.3514 74.1687 47.0821 74.2781 46.7715C74.3875 46.4608 74.3983 46.124 74.3092 45.807C74.22 45.49 74.0352 45.2082 73.78 45C71.6916 43.278 69.0631 42.347 66.3563 42.3708C63.6496 42.3946 61.0378 43.3715 58.98 45.13C58.7303 45.345 58.5526 45.6314 58.4709 45.9506C58.3891 46.2697 58.4073 46.6063 58.5228 46.9148C58.6384 47.2233 58.8458 47.489 59.1171 47.6759C59.3884 47.8628 59.7105 47.962 60.04 47.96L72.78 47.84Z" stroke="#4A5059" stroke-width="0.71" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M80.95 37.82L75.12 34.46L80.95 31.1" stroke="#4A5059" stroke-width="0.71" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M51.89 37.82L57.71 34.46L51.89 31.1" stroke="#4A5059" stroke-width="0.71" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M19.92 59.16V63.46" stroke="#4A5059" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M17.77 61.3101H22.07" stroke="#4A5059" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M101.42 62.2C101.961 62.2 102.4 61.7612 102.4 61.22C102.4 60.6788 101.961 60.24 101.42 60.24C100.879 60.24 100.44 60.6788 100.44 61.22C100.44 61.7612 100.879 62.2 101.42 62.2Z" fill="#4A5059"/>
                </svg>
                <p class="none">${message}</p>
            </div>
        `;
    }

    // Set up event delegation for dynamic elements
    function setupEventDelegation() {
        // Download button handler
        document.addEventListener('click', async (event) => {
            const targetButton = event.target.closest('.download-file-button');
            if (targetButton) {
                try {
                    const fileUrl = targetButton.dataset.fileUrl;
                    const fileName = targetButton.dataset.fileName;

                    if (!fileUrl || !fileName) {
                        throw new Error('Missing file URL or name');
                    }

                    // Update button state
                    targetButton.disabled = true;
                    targetButton.innerHTML = `
                         <svg  class="loading-spinner" id="progress-circle" width="24" height="24" viewBox="0 0 24 24" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12.0001" r="10" stroke="#EBEBEF" stroke-opacity="0.5" stroke-width="2" />
            <path id="progress-arc"
                d="M22 12.0001C22 10.6869 21.7413 9.38654 21.2388 8.17329C20.7362 6.96003 19.9997 5.85764 19.0711 4.92905C18.1425 4.00047 17.0401 3.26387 15.8268 2.76133C14.6136 2.25878 13.3132 2.00012 12 2.00012"
                stroke="#2DCA72" stroke-width="4" stroke-linecap="round" />
        </svg>
                        جار التحميل
                    `;

                    await downloadFileLogic(targetButton, fileUrl, fileName);

                    // Update button to show success
                    targetButton.style.backgroundColor = '#69fca825';
                    targetButton.innerHTML = `✔ تم التحميل `;

                } catch (error) {
                    console.error('Download error:', error);
                    // Reset button state on error
                    targetButton.disabled = false;
                    targetButton.innerHTML = `
                        <svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12.2783 17.0616V8.88965" stroke="#69FCA8" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M16.0303 13.2969C16.0303 13.2969 13.5023 17.0609 12.2783 17.0609C11.0543 17.0609 8.53027 13.2969 8.53027 13.2969" stroke="#69FCA8" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M3.02832 12.9756C3.02832 19.9126 5.34132 22.2256 12.2783 22.2256C19.2153 22.2256 21.5283 19.9126 21.5283 12.9756C21.5283 6.03859 19.2153 3.72559 12.2783 3.72559C5.34132 3.72559 3.02832 6.03859 3.02832 12.9756Z" stroke="#69FCA8" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        تحميل الكتاب
                    `;
                    alertify.error(ERROR_MESSAGES.DOWNLOAD_ERROR);
                }
            }
        });

        // Share button handler
        // document.addEventListener('click', async (event) => {
        //     const targetButton = event.target.closest('.share-button');
        //     if (targetButton) {
        //         try {
        //             const dataList = targetButton.closest('.dataList');
        //             if (!dataList) {
        //                 throw new Error('Could not find parent dataList element');
        //             }

        //             const downloadButton = dataList.querySelector('.download-file-button');
        //             const fileName = dataList.querySelector('.booktitle')?.textContent;
        //             const fileUrl = downloadButton?.dataset.fileUrl;

        //             if (!fileUrl) {
        //                 throw new Error('File URL not found');
        //             }

        //             if (navigator.share) {
        //                 await navigator.share({
        //                     title: fileName || 'مشاركة ملف',
        //                     url: fileUrl,
        //                 });
        //                 console.log('Content shared successfully');
        //             } else {
        //                 // Fallback for browsers without Web Share API
        //                 await navigator.clipboard.writeText(fileUrl);
        //                 showTempMessage('تم نسخ الرابط إلى الحافظة');
        //             }
        //         } catch (error) {
        //             console.error('Share error:', error);
        //             if (error.name !== 'AbortError') { // Don't show error if user canceled share
        //                 alertify.error(ERROR_MESSAGES.SHARE_ERROR);
        //             }
        //         }
        //     }
        // });

        // Group link direct handler
        document.addEventListener('click', (event) => {
            const targetButton = event.target.closest('.group-link-direct, .outWatch');
            if (targetButton) {
                const link = targetButton.getAttribute('href') || targetButton.getAttribute('link');
                if (link) {
                    window.open(link, '_blank');
                }
            }
        });

        // Inner watch handler
        document.addEventListener('click', (event) => {
            const targetButton = event.target.closest('.innerWatch');
            if (targetButton) {
                const youtubeUrl = targetButton.getAttribute('link');
                if (youtubeUrl) {
                    // Implement your inner watch functionality here
                    console.log('Opening YouTube video in internal viewer:', youtubeUrl);
                    // For now, just open in new tab
                    window.open(youtubeUrl, '_blank');
                }
            }
        });
    }

    // Copy link function (global as it might be called from HTML)
    window.copyLink = function (button) {
        try {
            const linkToCopy = button.getAttribute('link');
            if (!linkToCopy) {
                throw new Error(ERROR_MESSAGES.INVALID_LINK);
            }

            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = linkToCopy;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            tempTextArea.setSelectionRange(0, 99999);

            const successful = document.execCommand('copy');
            document.body.removeChild(tempTextArea);

            if (successful) {
                alertify.success(ERROR_MESSAGES.COPY_SUCCESS);

                // Update button tooltip temporarily
                const originalLabel = button.getAttribute('aria-label');
                button.setAttribute('aria-label', 'تم النسخ!');
                setTimeout(() => {
                    button.setAttribute('aria-label', originalLabel);
                }, 1500);
            } else {
                throw new Error(ERROR_MESSAGES.COPY_FAILED);
            }
        } catch (error) {
            console.error('Copy error:', error);
            alertify.error(error.message || ERROR_MESSAGES.COPY_FAILED);
        }
    };

    // Initialize the app when DOM is loaded
    document.addEventListener('DOMContentLoaded', initializeApp);

    // Add some basic styles for loading spinner
    const style = document.createElement('style');
    style.textContent = `
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
            10% { opacity: 1; transform: translateX(-50%) translateY(0); }
            90% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
        }
        @keyframes fadeOut {
            to { opacity: 0; }
        }
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            animation: spin 1s ease-in-out infinite;
            margin-right: 5px;
            vertical-align: middle;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    `;

    document.head.appendChild(style);

    // function to copy link to clipboard
    window.innerCopy = function (button, link) {
        try {
            const linkToCopy = link;
            if (!linkToCopy) {
                throw new Error(ERROR_MESSAGES.INVALID_LINK);
            }

            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = linkToCopy + "\nموقع مداد للملفات التعليمية";
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            tempTextArea.setSelectionRange(0, 99999);

            const successful = document.execCommand('copy');
            document.body.removeChild(tempTextArea);

            if (successful) {
                alertify.success(ERROR_MESSAGES.COPY_SUCCESS);

                button.textContent = '✔ تم النسخ!';
                button.disabled = true;
                setTimeout(() => {
                    button.setAttribute('aria-label', "تم النسخ");
                }, 1500);
            } else {
                throw new Error(ERROR_MESSAGES.COPY_FAILED);
            }
        } catch (error) {
            console.error('Copy error:', error);
            alertify.error(error.message || ERROR_MESSAGES.COPY_FAILED);
        }
    };

    // Hide share box function
    function hideShareBox() {
        const shareBox = document.querySelector('.shareBox');
        if (shareBox) {
            shareBox.style.display = 'none';

        }
    }

    // Show share box function   

    function showShareBox() {
        const shareBox = document.querySelector('.shareBox');
        if (shareBox) {
            shareBox.style.display = 'flex';
        }
    }


    /////////////////////////////////

    async function bookMark(bookId) {

        if (`<%= user ? "true" : "false" %>` === `false`) {
            return alertify.error('يرجى تسجيل الدخول');
        } else {

            try {
                const response = await fetch(`/bookMark/<%= user ? user._id : 'null' %>/<%= data._id %>`, {

                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                if (!response.ok) {
                    throw new Error('Failed to bookmark the book');
                }

                const data = await response.json();
                const bookmarkButton = document.querySelector('#bookMark');
                const bookmarkButtonText = document.querySelector('#bookMark a');
                let saveBookButtonSvg = document.querySelector("#bookMark svg path");

                if (data.action === "added") {

                    if (bookmarkButton) {
                        bookmarkButton.setAttribute('marked', '1');
                        bookmarkButtonText.textContent = "تم الإضافة للمرجعيات"
                        saveBookButtonSvg.style = "fill:#ffc107 !important; stroke:#ffc107 !important;";
                        bookmarkButton.setAttribute('aria-label', 'مفضل');
                    }
                    alertify.success(data.message || 'Bookmarked successfully');
                } else {
                    if (bookmarkButton) {
                        bookmarkButton.setAttribute('marked', '0');
                        bookmarkButtonText.textContent = "تم الإزالة من المرجعيات"
                        saveBookButtonSvg.style = "fill:none !important; stroke:#9b51e0 !important;";
                        bookmarkButton.setAttribute('aria-label', 'تفضيل');
                    }
                    alertify.success(data.message || 'un Bookmarked successfully');
                }

            } catch (error) {
                console.error('Bookmark error:', error);
                alertify.error(data.message || 'Failed to bookmark the book');
            }

        }
    }

    async function loadSavedBookmarks() {
        if (`<%= user ? "true" : "false" %>` === `false`) {
            return
        } else {
            try {
                const response = await fetch(`/booksMark/<%= user ? user._id : 'null' %>/<%= data._id %>`)
                if (!response.ok) {
                    throw new Error('Failed to load saved bookmarks');
                }
                const data = await response.json();
                if (data.status === true) {
                    let saveBookButton = document.querySelector("#bookMark");
                    let saveBookButtonSvg = document.querySelector("#bookMark svg path");
                    let saveBookButtonText = document.querySelector("#bookMark a");

                    saveBookButton.setAttribute('marked', '1');
                    saveBookButtonSvg.style = "fill:#ffc107 !important; stroke:#ffc107 !important;";
                    saveBookButtonText.textContent = "محفوظ في المرجعيات";
                    saveBookButton.setAttribute('aria-label', 'إضغط للإزالة');
                }
            } catch (error) {
                console.error('Error loading saved bookmarks:', error);
            }
        }
    }


    //  Get the URL from the browser
    const urlPath = window.location.href;
    //  Check for the meta og:url tag
    const ogURL = document.querySelector('meta[property="og:url"]');
    //  Add the meta og:url tag if not found
    if (!ogURL) {
        const meta = document.createElement('meta');
        meta.setAttribute('property', 'og:url');
        meta.setAttribute('content', urlPath);
        document.head.appendChild(meta);
    }

</script>

</html>